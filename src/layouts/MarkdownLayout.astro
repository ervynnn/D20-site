---
import Layout from '~/layouts/PageLayout.astro';
import SideNavigation from '~/components/ui/SideNavigation.astro';

export interface Props {
  frontmatter: {
    title?: string;
    description?: string;
  };
}

const { frontmatter } = Astro.props;

const metadata = {
  title: frontmatter?.title,
  description: frontmatter?.description,
};

// Build breadcrumb navigation from URL path
const buildBreadcrumbs = () => {
  const path = Astro.url.pathname;
  const segments = path.split('/').filter(segment => segment);
  const breadcrumbs = [{ text: 'Home', href: '/' }];
  
  let currentPath = '';
  for (let i = 0; i < segments.length; i++) {
    currentPath += '/' + segments[i];
    const isLast = i === segments.length - 1;
    
    let text = segments[i];
    
    // Format common system names
    if (text === 'modern.d20.srd') text = 'Modern D20 SRD';
    else if (text === 'future.d20.srd') text = 'Future D20 SRD';
    else if (text === 'arcana.d20.srd') text = 'Arcana D20 SRD';
    else if (text === 'menaces.d20') text = 'D20 Menaces';
    else {
      // Convert other segments to readable format
      text = text.replace(/\./g, ' ').replace(/\b\w/g, l => l.toUpperCase());
    }
    
    breadcrumbs.push({
      text,
      href: isLast ? '#' : currentPath
    });
  }
  
  return breadcrumbs;
};

// Generate navigation sections based on current path
const getNavigationSections = () => {
  const path = Astro.url.pathname;
  
  if (path.startsWith('/modern.d20.srd')) {
    return [
      {
        title: 'MODERN D20 SRD',
        color: 'blue',
        items: [
          { text: 'Basics', href: '/modern.d20.srd/basics' },
          { text: 'Classes', href: '/modern.d20.srd/classes' },
          { text: 'Combat', href: '/modern.d20.srd/combat' },
          { text: 'Condition Summary', href: '/modern.d20.srd/conditions' },
          { text: 'Creature Types', href: '/modern.d20.srd/creature.types' },
          { text: 'Creatures', href: '/modern.d20.srd/creatures' },
          { text: 'Environment & Hazards', href: '/modern.d20.srd/environment.hazards' },
          { text: 'Equipment', href: '/modern.d20.srd/equipment' },
          { text: 'Feats', href: '/modern.d20.srd/feats' },
          { text: 'FX', href: '/modern.d20.srd/fx' },
          { text: 'FX Items', href: '/modern.d20.srd/fx.items' },
          { text: 'Ordinaries', href: '/modern.d20.srd/ordinaries' },
          { text: 'Psionics', href: '/modern.d20.srd/psionics' },
          { text: 'Reputation', href: '/modern.d20.srd/reputation' },
          { text: 'Skills', href: '/modern.d20.srd/skills' },
          { text: 'Special Abilities', href: '/modern.d20.srd/special.abilities' },
          { text: 'Starting Occupation', href: '/modern.d20.srd/starting.occupation' },
          { text: 'Vehicle Movement and Combat', href: '/modern.d20.srd/vehicle.movement.and.combat' },
          { text: 'Wealth', href: '/modern.d20.srd/wealth' }
        ]
      }
    ];
  } else if (path.startsWith('/future.d20.srd')) {
    return [
      {
        title: 'FUTURE D20 SRD',
        color: 'purple',
        items: [
          { text: 'Classes', href: '/future.d20.srd/classes' },
          { text: 'Cybernetics', href: '/future.d20.srd/cybernetics' },
          { text: 'Environments', href: '/future.d20.srd/environments' },
          { text: 'Equipment', href: '/future.d20.srd/equipment' },
          { text: 'Expanded Skills', href: '/future.d20.srd/expanded.skills' },
          { text: 'Feats', href: '/future.d20.srd/feats' },
          { text: 'Mecha', href: '/future.d20.srd/mecha' },
          { text: 'Mutations', href: '/future.d20.srd/mutations' },
          { text: 'Progress Levels', href: '/future.d20.srd/progress.levels' },
          { text: 'Robots', href: '/future.d20.srd/robots' },
          { text: 'Scientific Engineering', href: '/future.d20.srd/scientific.engineering' },
          { text: 'Starships', href: '/future.d20.srd/starships' },
          { text: 'Starting Occupations', href: '/future.d20.srd/starting.occupations' },
          { text: 'Traveler Science', href: '/future.d20.srd/traveler.science' },
          { text: 'Vehicles', href: '/future.d20.srd/vehicles' },
          { text: 'Xenobiology', href: '/future.d20.srd/xenobiology' }
        ]
      }
    ];
  } else if (path.startsWith('/arcana.d20.srd')) {
    return [
      {
        title: 'ARCANA D20 SRD',
        color: 'green',
        items: [
          { text: 'Advanced Classes', href: '/arcana.d20.srd/advanced.classes' },
          { text: 'Creatures', href: '/arcana.d20.srd/creatures' },
          { text: 'Equipment', href: '/arcana.d20.srd/equipment' },
          { text: 'Feats', href: '/arcana.d20.srd/feats' },
          { text: 'FX Items', href: '/arcana.d20.srd/fx.items' },
          { text: 'Incantations', href: '/arcana.d20.srd/incantations' },
          { text: 'Occupations', href: '/arcana.d20.srd/occupations' },
          { text: 'Organizations', href: '/arcana.d20.srd/organizations' },
          { text: 'Prestige Classes', href: '/arcana.d20.srd/prestige.classes' },
          { text: 'Psionics', href: '/arcana.d20.srd/psionics' },
          { text: 'Shadowkind', href: '/arcana.d20.srd/shadowkind' },
          { text: 'Spells', href: '/arcana.d20.srd/spells' }
        ]
      }
    ];
  } else if (path.startsWith('/menaces.d20')) {
    return [
      {
        title: 'D20 MENACES',
        color: 'red',
        items: [
          { text: 'Buying Services', href: '/menaces.d20/buying.services' },
          { text: 'Feats', href: '/menaces.d20/feats' },
          { text: 'Menaces', href: '/menaces.d20/menaces' }
        ]
      }
    ];
  }
  
  return [];
};

const breadcrumbs = buildBreadcrumbs();
const navigationSections = getNavigationSections();
---

<Layout metadata={metadata}>
  <div class="flex min-h-screen">
    <!-- Sidebar Navigation -->
    {navigationSections.length > 0 && (
      <aside class="w-0 flex-shrink-0">
        <SideNavigation sections={navigationSections} />
      </aside>
    )}
    
    <!-- Main Content Area -->
    <main class="flex-1 min-w-0">
      <section class="px-4 sm:px-6 lg:px-8 mx-auto pt-6 lg:pt-8 pb-16 max-w-4xl">
        <!-- Breadcrumb Navigation -->
        <nav class="flex items-center space-x-2 text-sm text-gray-500 dark:text-slate-400 mb-6">
          {breadcrumbs.map((crumb, index) => (
            <Fragment>
              {index > 0 && <span>â€º</span>}
              {index === breadcrumbs.length - 1 ? (
                <span class="text-gray-900 dark:text-slate-300 font-medium">{crumb.text}</span>
              ) : (
                <a href={crumb.href} class="hover:text-primary transition-colors">{crumb.text}</a>
              )}
            </Fragment>
          ))}
        </nav>

        <!-- Page Title -->
        <h1 class="font-bold font-heading text-3xl md:text-4xl leading-tight tracking-tight text-gray-900 dark:text-slate-300 mb-6">
          {frontmatter.title}
        </h1>
        
        <!-- Content -->
        <div class="prose prose-sm max-w-3xl dark:prose-invert dark:prose-headings:text-slate-300 prose-headings:font-heading prose-headings:leading-tight prose-headings:tracking-tight prose-headings:font-bold prose-a:text-blue-600 dark:prose-a:text-blue-400 prose-img:rounded-md prose-img:shadow-lg">
          <slot />
        </div>
      </section>
    </main>
  </div>
</Layout>