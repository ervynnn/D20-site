---
import Layout from '~/layouts/PageLayout.astro';
import Features from '~/components/widgets/Features.astro';
import SideNavigation from '~/components/ui/SideNavigation.astro';
import type { NavigationSection } from '~/components/ui/SideNavigation.astro';

export interface Props {
  frontmatter: {
    title?: string;
    description?: string;
    tagline?: string;
    sections?: Array<{
      title: string;
      href: string;
      description?: string;
      icon?: string;
    }>;
  };
}

const { frontmatter } = Astro.props;

const metadata = {
  title: frontmatter?.title,
  description: frontmatter?.description,
};

// Organize sections for compact display
const organizeSections = (sections:  Array<{
  title: string;
  href: string;
  description?: string;
  icon?: string;
}>) => {
  const items = sections.map(section => ({
    title: section.title,
    description: section.description || '',
    icon: section.icon || 'tabler:book-2',
    callToAction: {
      target: '_self',
      text: 'View →',
      href: section.href,
    },
  }));
  return items;
};

// Generate navigation sections based on current system
const getNavigationSections = (): NavigationSection[] => {
  const path = Astro.url.pathname;
  
  if (path.startsWith('/modern.d20.srd')) {
    return [
      {
        title: 'MODERN D20',
        color: 'blue',
        items: [
          { text: 'Basics', href: '/modern.d20.srd/basics' },
          { text: 'Classes', href: '/modern.d20.srd/classes' },
          { text: 'Equipment', href: '/modern.d20.srd/equipment' },
          { text: 'Combat', href: '/modern.d20.srd/combat' },
          { text: 'Skills', href: '/modern.d20.srd/skills' },
          { text: 'Feats', href: '/modern.d20.srd/feats' },
          { text: 'Creatures', href: '/modern.d20.srd/creatures' },
          { text: 'Wealth', href: '/modern.d20.srd/wealth' },
        ]
      }
    ];
  } else if (path.startsWith('/future.d20.srd')) {
    return [
      {
        title: 'FUTURE D20',
        color: 'purple',
        items: [
          { text: 'Classes', href: '/future.d20.srd/classes' },
          { text: 'Cybernetics', href: '/future.d20.srd/cybernetics' },
          { text: 'Mecha', href: '/future.d20.srd/mecha' },
          { text: 'Mutations', href: '/future.d20.srd/mutations' },
          { text: 'Equipment', href: '/future.d20.srd/equipment' },
          { text: 'Progress Levels', href: '/future.d20.srd/progress.levels' },
          { text: 'Starships', href: '/future.d20.srd/starships' },
          { text: 'Robots', href: '/future.d20.srd/robots' },
        ]
      }
    ];
  } else if (path.startsWith('/arcana.d20.srd')) {
    return [
      {
        title: 'ARCANA D20',
        color: 'green',
        items: [
          { text: 'Advanced Classes', href: '/arcana.d20.srd/advanced.classes' },
          { text: 'FX Items', href: '/arcana.d20.srd/fx.items' },
          { text: 'Incantations', href: '/arcana.d20.srd/incantations' },
          { text: 'Creatures', href: '/arcana.d20.srd/creatures' },
          { text: 'Equipment', href: '/arcana.d20.srd/equipment' },
          { text: 'Organizations', href: '/arcana.d20.srd/organizations' },
          { text: 'Prestige Classes', href: '/arcana.d20.srd/prestige.classes' },
          { text: 'Spells', href: '/arcana.d20.srd/spells' },
        ]
      }
    ];
  } else if (path.startsWith('/menaces.d20')) {
    return [
      {
        title: 'D20 MENACES',
        color: 'red',
        items: [
          { text: 'Menaces', href: '/menaces.d20/menaces' },
          { text: 'Feats', href: '/menaces.d20/feats' },
          { text: 'Buying Services', href: '/menaces.d20/buying.services' },
        ]
      }
    ];
  }
  
  return [];
};

const navigationSections = getNavigationSections();
---

<Layout metadata={metadata}>
  <div class="flex min-h-screen">
    <!-- Sidebar Navigation -->
    {navigationSections.length > 0 && (
      <aside class="w-64 flex-shrink-0">
        <SideNavigation sections={navigationSections} />
      </aside>
    )}
    
    <!-- Main Content Area -->
    <main class="flex-1 min-w-0">
      <!-- System Title and Description -->
      <section class="px-4 py-8 sm:px-6 mx-auto lg:px-8 lg:py-12 max-w-6xl">
        <div class="text-center pb-8">
          <h1 class="font-bold font-heading text-4xl md:text-5xl leading-tighter tracking-tighter text-gray-900 dark:text-slate-300">
            {frontmatter.title}
          </h1>
          {frontmatter.description && (
            <p class="text-xl text-gray-600 dark:text-slate-400 mt-4 max-w-3xl mx-auto">
              {frontmatter.description}
            </p>
          )}
        </div>
        
        <!-- Breadcrumb Navigation -->
        <nav class="flex items-center space-x-2 text-sm text-gray-500 dark:text-slate-400 mb-8">
          <a href="/" class="hover:text-primary transition-colors">Home</a>
          <span>›</span>
          <span class="text-gray-900 dark:text-slate-300">{frontmatter.title}</span>
        </nav>
      </section>

      <!-- All Sections Grid -->
      {frontmatter.sections && frontmatter.sections.length > 0 && (
        <Features
          title="Reference Sections"
          subtitle="Browse all available sections in this system reference document."
          items={organizeSections(frontmatter.sections)}
          classes={{ container: 'max-w-6xl' }}
          columns={4}
        />
      )}

      <!-- Standard Content Area for any additional markdown -->
      <section class="px-4 py-8 sm:px-6 mx-auto lg:px-8 max-w-6xl">
        <div class="mx-auto prose prose-lg max-w-4xl dark:prose-invert dark:prose-headings:text-slate-300 prose-md prose-headings:font-heading prose-headings:leading-tighter prose-headings:tracking-tighter prose-headings:font-bold prose-a:text-blue-600 dark:prose-a:text-blue-400 prose-img:rounded-md prose-img:shadow-lg">
          <slot />
        </div>
      </section>
    </main>
  </div>
</Layout>
